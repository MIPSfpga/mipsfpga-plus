
<p><big><b>4. Homework: doing everything in assembly</b></big></p>

<p>This section guides the student through the activity of analyzing the
interrupt processing on assembly level.  This activity helps to have a clear
picture on how everything works.</p>

<p><big><b>4.1. Disassemble the ELF file created during the lab</b></big></p>

<p>Under Windows:</p>

<blockquote><pre>
cd programs\04_interrupts
04_disassemble.bat
</pre></blockquote>

<p>Under Linux:</p>

<blockquote><pre>
cd programs/04_interrupts
./04_disassemble.sh
</pre></blockquote>

<p>The generated file is called <i>program.dis</i>.  It is located in the
current directory.</p>

<p><big><b>4.2.  Review and explain the interrupt-related sections of the
code</b></big></p>

<p>Analyze the following sections of
<i>programs/04_interrupts/program.dis</i> file:</p>

<p>The code for the interrupt vector:</p>

<img width=500
src="http://www.silicon-russia.com/wp-content/uploads/2017/01/Screenshot-2017-01-15-21.09.07.png"
/>

<p>The code for the interrupt handler:</p>

<img width=500
src="http://www.silicon-russia.com/wp-content/uploads/2017/01/Screenshot-2017-01-15-21.09.56.png"
/>

<p>The code for setting up the interrupts:</p>

<img
src="http://www.silicon-russia.com/wp-content/uploads/2017/01/Screenshot-2017-01-15-21.17.34.png"
/>

<p>The code that guards incrementing the counter in the main loop against
interrupts.  Such guarding is accomplished using <i>di/ei</i> instruction
pair (disable interrupts / enable interrupts).  Can you explain why is it
necessary?  What wrong could happen if these instructions are missing?  Can
you guess a scenario when such guarding is not going to work?</p>

<img
src="http://www.silicon-russia.com/wp-content/uploads/2017/01/Screenshot-2017-01-15-21.11.05.png"
/>

<p><big><b>4.3.  Rewrite the whole lab in assembly.  Can you hand-write an
interrupts service routine in assembly that has fewer instructions and works
faster than the routine generated by GNU C compiler?</b></big></p>
